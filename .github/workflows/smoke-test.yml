name: Manual test workflow

on:
  workflow_dispatch:

jobs:
  windows-smoke-test:
    runs-on: windows-latest
    defaults:
      run:
        working-directory: hello-world
        shell: bash        
        
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'    

      - name: NPM install
        run: |
          npm install
          
      - name: Run dev server
        run: |
          npm run start &
          
      - name: Hit dev server
        run: |
          curl --no-progress-meter http://localhost:3000/ > home.txt
          grep '/partial/Cars' < home.txt
          
          curl --no-progress-meter http://localhost:3000/partial/Cars > Cars.txt 
          grep 'Volkswagen' < Cars.txt
          
          curl --no-progress-meter http://localhost:3000/should/fail/does/it/error/action > should-fail.txt
          grep 'Will not have this' < should-fail.txt
          
          echo ""
          echo "OK, I think?"

